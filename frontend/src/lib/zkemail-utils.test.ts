import fs from 'fs/promises'
import path from 'path'
import { parseEmailData } from './zkemail-utils'

/*
bun run test src/lib/zkemail-utils.test.ts
*/

describe('zkemail-utils', () => {
	it('parse email', async () => {
		const eml = await fs.readFile(path.join(__dirname, '../../..', 'emails', `registration.eml`), 'utf-8')
		const emailData = await parseEmailData(eml)

		const expected = [
			'6632353713085157925504008443078919716322386156160602218536961028046468237192',
			'179174940957233788236917956282329359906',
			'176110912359975412458775129071667004373',
			'144410967236643786077007722',
			'4992959312512230116538335825132076927052637790830533900315071821365',
			'0',
			'177045085285232709542537618269527952589681117750617699131261990920761210928',
			'92257159006731089366315165519870804725597858279156282923563106939566373177',
			'1664575074',
			'86956402115569186678976683596652684038744075192332976861274474050868246576',
			'60711670697043939388974385',
			'0',
			'175623169235831462012555507320332121853822492850461715729383597280344635440',
			'86949585669759892137776293893024742922374716279324892407328097120528196153',
			'895639908',
		]

		expect(JSON.stringify(emailData.signals) === JSON.stringify(expected)).toBe(true)
	})
})
